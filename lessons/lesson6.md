# 第六节：场景交互

图案的设计是游戏中的一个重要组成部分，那么就该提到关于审美和应用这两者谁更重要。一个好的审美要素对于应用的理解程度提升是十分巨大的，倘若是仅凭缜密丰富的应用逻辑，也并非不可铸成一部受青睐的作品(比如游戏:火材人系列)。对于初次接触游戏编程的各位，虽然建议先将编程的逻辑理解透彻，但鉴于技术更依赖沉淀，而设计则有许多现成可以参考，并且通过一个漂亮的设计也能给自己增加动力。通过在前面的`第一节`中所介绍的像素颜色，我们可以参照网上的图例动手将有趣的图案亲自绘制出来。  

?>本节课我们需要完成的目标是抛开预给的像素图案自己动手绘制卡通图案并且结合场景设置对话

为了完成目标，我们需要掌握如下知识  

1. 改变`场景`
2. 场景`砖块`的交互特性
3. 绘制专属图案 
4. 精灵`说`  

## 要点1：改变'背景'和'砖块地图'  
  
除了精灵，在游戏中丰富的场景也是必不可少，在此我们能够掌握以下改变场景的方式
1. 通过改变背景图像
2. 通过设置场景砖块  

?>这两者是不冲突的，一个最大区别就是背景图像是不带交互特性的，而场景砖块则是有这个特性  
 
**1. 设置背景图像**

设置背景划分为设置颜色和设置图片，他们其实是一个包含关系。你完全可以用设置图片来填充不同颜色达到比设置颜色更丰富的画面  

![](image/l6_p1.png)

演示一下他们的功能  
  
![](image/l6_2.gif)
  
**2. 设置砖块地图**  
  
设置砖块地图我们是有一个顺序的，这个必要流程打个比方就像画画，首先我们要画一个人物，通常需要先素描大致轮廓再进行细节填充。砖块也是需要这么做，顺序如图    

![](image/l6_p2.png)   
  
?>虽然知道了它的功能，但我们需要知道它的具体流程，首先是`设置砖块地图`(素描过程)

①. 选择像素尺寸为10x8。这么选择的理由是在场景绘图中，最小画笔尺寸是16x16像素(也就是编辑器内的一格就是16像素的正方形)，而喵比特的屏幕尺寸是160x128。除以16的话刚好是10x8  
②. 选择颜色，这里颜色不用太拘泥，只是用于后续砖块的设置(细节填充)是根据相同颜色归为一类进行填充  
③. 绘制你的地图砖块(也可以称之为障碍物)  
  
![](image/l6_p3.png) 


?>开始第二步填充砖块   

由于我们已经知道最小像素是16像素，所以这里用于填充的砖块图像我们最好选择16x16全屏填充，我们使用预给的图案(16x16的像素石头) 当然你也可以自己试试其他分辨率看看有什么不一样。  

①. 按照`设置砖块地图`里使用的颜色换色，所以在此我们也选择黄色   
![](image/l6_p5.png)  

②. 选择石头，而后所有的黄色区域都变成了一个个石头了

![](image/l6_p6.png) 

## 要点2：场景交互  

场景交互指的是精灵和砖块的一个碰撞问题 
  
在此我们需要的额外知识点有如下:
- 精灵的`创建`
- 控制精灵`移动`
- 精灵的`位置`
  
搭建如下程序

![](image/l6_p7.png)   
  
通过点击设置砖块地图后面的符号+，添加新的参数让精灵无法与砖块重叠

![](image/l6_p8.png)   

## 要点3：绘制专属精灵  

预给的图像还是太有限，我们更愿意按照自己喜爱的图案来设计  

当然像素图的设计也是需要一定功底的，但我们可以明确自己喜爱的卡通角色，并借助工具来生成像素图而后手动绘制出来。其中推荐2种方法：

**①. 直接在网上搜索自己喜欢的图片像素图。比如`皮卡丘像素图`**

![](image/l6_1.gif) 

```javascript
enum SpriteKind {
    Player,
    Projectile,
    Food,
    Enemy
}
let mySprite: Sprite = null
mySprite = sprites.create(img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    f f . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    f f f f . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    f f f f f . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . f f 5 5 f . . . . . . . . . . . . . . . . . . . . . . . . . .
    . f 5 5 5 5 f . . . . . . . . . . . . . . . . . . . . . . . . .
    . f 5 5 5 5 5 f . . . . . . . . . . . . . . . . . . . . f f f f
    . . f 5 5 5 5 f . . . . . . . . . . . . . . . . . f f f 5 f f f
    . . f 5 5 5 5 5 f . . . . . . . . . . . . . . f f 5 5 5 5 5 5 f
    . . . f 5 5 5 5 f . f f f f f f f f f . . f f 5 5 5 5 5 5 5 f f
    . . . f 5 5 5 5 f f 5 5 5 5 5 5 5 5 5 f f 5 5 5 5 5 5 5 5 f . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f . . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f 5 5 5 f . . . .
    . . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f 5 f . . . . .
    . . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f f . . . . . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f . . . . . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f . . . . . .
    . . . f 5 5 5 f f f 5 5 5 5 5 5 5 5 5 f f f 5 5 5 5 f . . . . .
    . . . f 5 5 f f f 1 f 5 5 5 5 5 5 5 f f f 1 f 5 5 5 f . . . . .
    . . . f 5 5 f f f f f 5 5 5 5 5 5 5 f f f f f 5 5 5 f . . . . .
    . . . f 5 5 f f f f f 5 5 5 5 5 5 5 f f f f f 5 5 5 f . . . . .
    . . f 5 5 5 5 f f f 5 5 5 5 5 5 5 5 5 f f f 5 5 5 5 5 f . . . .
    . . f 5 5 5 5 5 5 5 5 5 5 5 f 5 5 5 5 5 5 5 5 5 5 5 5 f . . . .
    . . f 5 5 2 2 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 5 5 f . . . .
    . . f 5 2 2 2 2 5 5 5 5 5 5 f 5 5 5 5 5 5 5 2 2 2 2 5 f . . . .
    . . f 5 2 2 2 2 5 5 5 5 f f 5 f f 5 5 5 5 5 2 2 2 2 5 f . . . .
    . . . f 5 2 2 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 5 f . . . . .
    . . . . f f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f f . . . . . .
    . . . . . . f f f f f 5 5 5 5 5 5 5 f f f f f f . . . . . . . .
    . . . . . . . . . . . f f f f f f f . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
`, SpriteKind.Player)
scene.setBackgroundColor(1)

```

**②. 我们也可以使用大分辨率的图片在PS(photoshop)里改变尺寸并添加网格，再参考绘制**  

- 改变尺寸

![](image/l6_p9.png) 

![](image/l6_p10.png)  

- 添加网格线

![](image/l6_p11.png)  

![](image/l6_p12.png)  


 
## 要点4：精灵'说' 

这个是用于让精灵说话的积木块
![](image/l6_p13.png)  

![](image/l6_3.gif) 
  
## 完成目标  

为了完成目标，我们还需要了解`游戏结束`积木块，以及`碰撞墙`事件积木块，他们分别在`Game`分栏和`场景`分栏下。  
  
当我们跟随`要点2`的步骤完成了限制精灵与墙重叠后我们还需要在此通过`碰撞墙`事件积木块来告诉程序当我们碰到墙需要做什么，这里我们就让精灵说NO。(注意，类似`说`积木块等一些积木块后面都有+号，表示有附带功能可供选择)

我们需要告诉程序怎样才能让精灵不说NO，而是反馈给我们胜利的字样，此时我们就需要用到`游戏结束`积木块。  
综上得到如下程序  

![](image/l6_4.gif)  

```javascript  
enum SpriteKind {
    Player,
    Projectile,
    Food,
    Enemy
}
let mySprite: Sprite = null
scene.onHitTile(SpriteKind.Player, 5, function (sprite) {
    sprite.say("NO!", 200)
})
mySprite = sprites.create(img`
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    f f . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    f f f f . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    f f f f f . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . f f 5 5 f . . . . . . . . . . . . . . . . . . . . . . . . . .
    . f 5 5 5 5 f . . . . . . . . . . . . . . . . . . . . . . . . .
    . f 5 5 5 5 5 f . . . . . . . . . . . . . . . . . . . . f f f f
    . . f 5 5 5 5 f . . . . . . . . . . . . . . . . . f f f 5 f f f
    . . f 5 5 5 5 5 f . . . . . . . . . . . . . . f f 5 5 5 5 5 5 f
    . . . f 5 5 5 5 f . f f f f f f f f f . . f f 5 5 5 5 5 5 5 f f
    . . . f 5 5 5 5 f f 5 5 5 5 5 5 5 5 5 f f 5 5 5 5 5 5 5 5 f . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f . . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f 5 5 5 f . . . .
    . . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f 5 f . . . . .
    . . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f f . . . . . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f . . . . . .
    . . . . f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f . . . . . .
    . . . f 5 5 5 f f f 5 5 5 5 5 5 5 5 5 f f f 5 5 5 5 f . . . . .
    . . . f 5 5 f f f 1 f 5 5 5 5 5 5 5 f f f 1 f 5 5 5 f . . . . .
    . . . f 5 5 f f f f f 5 5 5 5 5 5 5 f f f f f 5 5 5 f . . . . .
    . . . f 5 5 f f f f f 5 5 5 5 5 5 5 f f f f f 5 5 5 f . . . . .
    . . f 5 5 5 5 f f f 5 5 5 5 5 5 5 5 5 f f f 5 5 5 5 5 f . . . .
    . . f 5 5 5 5 5 5 5 5 5 5 5 f 5 5 5 5 5 5 5 5 5 5 5 5 f . . . .
    . . f 5 5 2 2 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 5 5 f . . . .
    . . f 5 2 2 2 2 5 5 5 5 5 5 f 5 5 5 5 5 5 5 2 2 2 2 5 f . . . .
    . . f 5 2 2 2 2 5 5 5 5 f f 5 f f 5 5 5 5 5 2 2 2 2 5 f . . . .
    . . . f 5 2 2 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 2 2 5 f . . . . .
    . . . . f f 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 f f . . . . . .
    . . . . . . f f f f f 5 5 5 5 5 5 5 f f f f f f . . . . . . . .
    . . . . . . . . . . . f f f f f f f . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
`, SpriteKind.Player)
mySprite.setPosition(16, 98)
scene.setTileMap(img`
    5 5 5 5 5 5 5 5 5 5
    5 . . . . . . . . .
    5 . . . . . . . . .
    5 . . . . . . . . 5
    5 . . . . . . . . 5
    . . . . . . . . . 5
    . . . . . . . . . 5
    5 5 5 5 5 5 5 5 5 5
`)
scene.setTile(5, img`
    . . . . . c c b b b . . . . . .
    . . . . c b d d d d b . . . . .
    . . . . c d d d d d d b b . . .
    . . . . c d d d d d d d d b . .
    . . . c b b d d d d d d d b . .
    . . . c b b d d d d d d d b . .
    . c c c c b b b b d d d b b b .
    . c d d b c b b b b b b b b d b
    c b b d d d b b b b b d d b d b
    c c b b d d d d d d d b b b d c
    c b c c c b b b b b b b d d c c
    c c b b c c c c b d d d b c c b
    . c c c c c c c c c c c b b b b
    . . c c c c c b b b b b b b c .
    . . . . . . c c b b b b c c . .
    . . . . . . . . c c c c . . . .
`, true)
scene.setBackgroundColor(9)
controller.moveSprite(mySprite)
game.onUpdate(function () {
    if (mySprite.x >= 144) {
        game.over(true)
    }
})

``` 

---

**这节课我们学到了什么？**  
- 场景砖块的创建
- 与游戏场景的基础交互
